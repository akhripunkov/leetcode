Обновленный SQL-запрос
Для нахождения чисел, которые повторяются подряд хотя бы три раза, вы можете использовать следующий SQL-запрос:

sql
Copy code
WITH Ranked AS (
    SELECT 
        num,
        ROW_NUMBER() OVER (ORDER BY id) AS rn,
        ROW_NUMBER() OVER (PARTITION BY num ORDER BY id) AS num_rn
    FROM Logs
),
Grouped AS (
    SELECT 
        num,
        rn - num_rn AS grp
    FROM Ranked
)
SELECT DISTINCT num AS ConsecutiveNums
FROM Grouped
GROUP BY num, grp
HAVING COUNT(*) >= 3;
Объяснение запроса
CTE Ranked:

Мы используем ROW_NUMBER() дважды:
Один для общего порядка по id (rn).
Другой, чтобы присвоить номер каждой строке в рамках каждой группы num (num_rn).
CTE Grouped:

Мы вычисляем разницу между rn и num_rn. Это создаст одинаковое значение (grp) для каждой группы последовательных вхождений одного и того же числа.
Основной запрос:

Мы выбираем уникальные числа (num) и группируем их по num и grp.
Используем HAVING для фильтрации групп, где количество вхождений (COUNT(*)) равно 3 или более.
Пример входных данных
Для входных данных:

diff
Copy code
+----+-----+
| id | num |
+----+-----+
| 1  | 38  |
| 2  | 38  |
| 3  | 14  |
| 4  | 14  |
| 5  | 14  |
| 6  | 13  |
+----+-----+
Ожидаемый вывод
Если мы ожидаем, что 14 появится подряд три раза, запрос вернет:

diff
Copy code
+-----------------+
| ConsecutiveNums |
+-----------------+
| 14              |
+-----------------+
Примечание
Убедитесь, что вы правильно создаете временные таблицы и используете оконные функции.
Если вы все еще сталкиваетесь с ошибками, проверьте, чтобы у вас не было проблем с версией SQL Server или синтаксисом, специфичным для вашей базы данных.
Если вам нужна дополнительная помощь или вы хотите уточнить что-то, дайте знать!